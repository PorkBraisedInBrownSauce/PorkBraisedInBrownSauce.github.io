---
title: 组合优化算法
date: 2016-05-16 22:46:05
tags:
---
由于数学能力有限，只能说大白话。

首先说一下什么是组合优化。组合优化是优化的一个分支，与实优化相对的概念，也可以叫做离散优化。它的优化目标集是一个有限集，例如整数优化、0/1规划等。由于有限集的特点，一般可以通过遍历达到解决组合优化问题的目的，但是不论是子集，还是排列、组合等问题，如果采取遍历，往往问题规模是指数级别的大小，即所谓的指数爆炸，所以就有所谓的组合优化问题。常见的组合优化问题：最短路问题、最小生成树问题、网络流问题、匹配问题、TSP问题、SAT问题、汉密尔顿圈问题等。

离散域是不可导的（因为不连续）。数值最优化方法不能带到离散域中。离散域中的问题往往是一个问题一个方法，导致组合优化与数值优化有很大区别。

## I.多项式级别的组合优化算法
常见的多项式组合优化算法有4种：短路问题、最小生成树问题、网络流问题、匹配问题。并由之派生出一些其他问题。他们的解法大部分属于**primal-dual+search**的设计思路，也有用动态规划思想的。

primal-dual方法是多项式组合优化的核心方法之一，它是利用线性规划（LP）的原始对偶方法将一个大问题化解为小问题一步一步解决，并从中观察得出算法的策略。简而言之，一切优化问题都要满足可行性和最优性，primal-dual算法的目的是保持最优性，逐步消除不可行性。

### 1.最短路问题
最短路问题主要有Dijkstra算法、Bellman-Ford算法、Floyd-Warshall算法等。Dijkstra算法采用primal-dual的思想，后两个算法采用动态规划。

* **Dijkstra算法**

写出最短路问题的LP：

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.15.1.gif">

其中A为点弧关联矩阵，由于A满足全单模条件，所以去除了f=0,1的约束。由于问题的特殊结构可以删除一行约束：

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.15.4.gif">

写出dual:

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.15.2.gif">

再写出DRP:

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.15.3.gif">

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.15.5.gif">

此时就得到DRP，DRP给出了如何improve的方法：不断改进以使问题达到可行。一定要注意到这里的最短路径问题含有非常多的特殊结构，包括全单模、秩的特点等等。

如果我们拿出一个例子会惊异的发现，从s出发，初始解为(0,0,...)'，DRP的求解过程实际是一个贪心的过程。

直观的说，dual问题中的y被称为“势”，可以解释为“海拔”，dual问题提供了primal的下界，由于这是LP，所以，最优解要满足dual的解=primal的解。s-t的海拔实际是将所有城市比拟为绳子上的小球，权重解释为小球之间的绳子长度，那么将s点和t点拉起来，实际就得到了所谓的最短路径，也是最大海拔。

* **Bellman-Ford算法**

Bellman-Ford算法使用DP的技术，可以处理还有负圈的最短路径问题（Dijkstra算法为什么不可以？）。

使用动态规划，要确定决策变量：这里有3个i,j,k。i表示起点，j表示终点，k表示i到j所需最多的边（确定好决策变量这一步是很困难的），那么得到递归式：

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.15.6.png" width=400 height=50>

return OPT[s,t,n-1]

含义是很明确的：每一步的决策或者是上一步的决策（最多使用k-1条边就可以达成），或者有新的边加进来。

* **Floyd-Warshall算法**

Floyd-Warshall算法可以解决任意两点之间的最短路径问题。也采用DP的策略。

同样有3个决策变量：i,j,k。i表示起点，j表示终点，k表示i到j以(1..k)中的节点为中间节点。

<img src="https://upload.wikimedia.org/math/8/d/a/8dad6c9c6f54c849e730c19a48598c84.png">

若i到j最短路径不经过k，则

<img src="https://upload.wikimedia.org/math/b/6/f/b6fd348302496399233dce43e708aa21.png">

若经过k，则

<img src="https://upload.wikimedia.org/math/e/3/a/e3aee6a3e2a2083164cdfee6f1c9ad03.png">

### 2.网络流问题

* **Ford-Fulkerson算法**


Ford-Fulkerson算法是网络流的最原始算法。写出LP：

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.15.7.gif">

其中，A为点弧关联矩阵，f为流量，dv表示中间节点流量守恒，源点、汇点流量为v,-v。

这本来就是一个dual，写出DRP：

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.15.8.gif">

发现一个重要问题：f<=0与f>=0，表示：

饱和弧是后向弧；空弧是前向弧。

写出逆否命题：

前向弧是非饱和；后向弧是非空弧。

improve的目标是搜索这样的路，被称为“增广路”。然后让它们由不可行变为可行。

看看如何改善：

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.15.5.gif">

我多次说过特殊结构，有多项式算法的问题无一例外都是具有特殊结构的问题。

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.15.9.png"width=300 height=50>

有这个式子，当然可以进行算法设计了。但是，一般我们可以由这个式子设计一种特殊的图：剩余图。使得剩余图+上一步迭代的图=新图。

得出了Ford-Fulkerson算法基本步骤：

	init f(e)=0 for all e
	while there's an s-t path in residual graph:
		arbitrarily choose an s-t path p in residual graph
		choose a bottleneck to Augment(p,f)
	return f 

* **Edmonds-Karp算法**

Ford-Fulkerson算法有一个很大的缺点：当容量限制不合理的时候回出现长久跳不出循环或者无限循环的问题。

如果我们对算法中的一些步骤做一下限制，能不能克服这个缺点？这个改进就是Edmonds-Karp算法，它每次选择最短的s-t路而不是任意选择。也就是加入了search的策略。

	init f(e)=0 for all e
	while there's an s-t path in residual graph:
		BFS choose an shortest s-t path p in residual graph
		choose a bottleneck to Augment(p,f)
	return f 


* **最小费用流算法**

列出最小费用流的LP：

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.15.10.gif">

将min c'f变为max -c'f，然后变为DRP：

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.15.11.gif">

注意约束也很特别，尤其是Af=0，结合Ford-Fulkerson算法，这里的含义是：寻找空弧非负，饱和弧非正的循环流。找到之后，improve。

那也就是说，我们找到一个特殊的循环流，它的花费是负的，那么这个图就有改善的可能。这也就是所谓的Klein圈算法。

* **Hitchcock问题**

Hitchcock问题指派问题的推广，也涵盖了二部图的最小费用流。它的求解算法对指派问题都很有借鉴。

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.16.2.png" width=250>

可以将这个问题建模为最小费用流，这里探讨primal-dual的思路，得到一个应用更为广泛的算法。写出dual：

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.16.3.png" width = 300>

写出DRP：

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.16.5.png" width = 230>

再写出RP:

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.16.4.png" width = 230>

为什么平时不写RP，这里要写出RP。可以看出RP比较繁琐一点，而且只要有dual就可以推出DRP，似乎RP没有存在的价值。但是这里的RP可以做一个小小的变换：

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.16.6.png" width = 500>

此时可以得到等价的RP'：

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.16.7.png" width=200>

RP'实际是一个最大流问题。现在我们的解决方案似乎是这样：dual->primal->RP'->DRP这样循环去做，其中的核心步骤是RP'负责运行最大流算法，找出需要improve的节点；DRP负责improve。



### 3.匹配问题

匹配问题也是多项式组合优化问题中的一大类重要问题。基本包含4种：二部图基数匹配，二部图赋权匹配，非二部图基数匹配，非二部图赋权匹配。

* **二部图基数匹配**

匹配问题较难写出LP，故而主要借鉴其他算法的思路，结合search方法。

最简单的思路是直接建模为最大流，添加源点和汇点，将容量限制设为1，采用Edmonds-Karp算法就可以求出。那有没有更一般的算法呢？这就是著名的“匈牙利算法”。

匈牙利算法基于很简单的观察：如果我得到一个匹配，如何improve？

此时如果存在这样一条路：从未盖点出发，依次经过以盖点，未盖点，...，直到未盖点。那么未盖点-以盖点=1，也就是说，此时将以盖点变为未盖点，未盖点变为以盖点就可以多覆盖一个点，improved！这条路也叫“增广路”，而以盖点、未盖点依次出现的路叫做交错路。

以下是伪代码：

	bool 寻找从k出发的对应项出的可增广路
	{
    	while (BFS from k to j)
   	   {
     	   if (j不在增广路上)
    	    {
    	        把j加入增广路;
     	       if (j是未盖点 或者 从j的对应项出发有可增广路)
     	       {
       	         修改j的对应项为k;
       	         则从k的对应项出有可增广路,返回true;
      	      }
     	   }
  	  }
	    则从k的对应项出没有可增广路,返回false;
	}

	void Hungary()
	{
	    for i->1 to n
   	 {
   	     if (则从i的对应项出有可增广路)
     	       匹配数++;
   	 }
  	  输出 匹配数;
	}


* **二部图赋权匹配**

二部图最大赋权匹配是二部图基数匹配的推广。w:=max{wi}-w，通过这个式子，将二部图最大赋权匹配转化为二部图最小赋权匹配。

那么仍然可以直接model到网络流问题，也就是最小费用流问题。其次可以采用匈牙利算法，具体来讲是Kuhn–Munkres算法。还可以采用primal-dual的方法。

二部图赋权匹配属于指派问题，可以采用Hitchcock问题的算法。

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.16.1.png"width=150>


* **非二部图匹配**

非二部图问题与二部图问题的主要区别在于：二部图中，增广路不可能构成圈，那么匈牙利算法就不可能失效。非二部图中，增广路可能构成圈，而且这个圈肯定是奇圈（花），所以算法的改进在于怎么让花消失。


### 4.拟阵与最小生成树问题
拟阵是满足以下两条定义的集合关系：

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.15.12.png" width = 550>

实际上，它是对线性代数中的向量之间的相互独立的数学抽象。想想向量之间的相互独立是不是也具有以上的性质。

<img src="http://7xs6jl.com1.z0.glb.clouddn.com/5.16.8.png" height = 300>

拟阵有一个最为基本的优化性质：极大独立集一定是最大独立集合——表示为拟阵的 Greedy 算法。

其中最小生成树就是利用了这个性质而设计的Greedy算法。不论是Kruskal算法，还是Prim算法，他们都遵循贪婪的思想。

## II.复杂问题的解法
复杂问题中有一部分是可以被证明是NP-Complete问题，有一部分是悬而未决的NP问题。对于复杂问题既可以精确求解，也可以求出近似解。

### 分支限界

分支限界是典型的穷举剪枝算法，和回溯法是一样的思路，不同在于回溯法的回溯是确定的，而B&B中限界在于个人的选择，限界标准的好坏直接影响算法的好坏。如果界太紧，很容易丢弃可行解；如果界太松，算法效率低。

### 动态规划

动态规划(dynamic programming)是求解多阶段决策优化问题的一种有效方法。它可以用于离散、连续、随机等多种类型的问题，应用领域非常广泛。设计动态规划的一种典型思路是给出需要求解的实例最优解与另一规模较小的实例最优解之间的递推关系。由于规模最小的那些实例最优解容易求得，从而可以以此为初始条件，进而利用递推关系一步一步求得最优解。

一个可以使用DP求解的问题必须满足：可分解为相互关联的子问题，最优化定理，无后效性。

### 近似算法和近似方案

对于 NP—难的组合优化问题，如果实例规模比较大，求得最优解往往需要相当长的时间。因此，如果时间上的限制比对精度上的要求更严格，可以考虑“用精度换时间”，即在多项式时间内得到一个与最优解较为接近的可行解，称为近似解。

启发式算法是近似算法的一种，可以用于组合优化问题的有：模拟退火算法、遗传算法、蚁群算法等等。

Greedy也是可以用于解决难问题的思路。满足贪心选择性的问题不多，但是如果有一个好的标准，Greedy也许能得到满意的结果，并且速度很快。实际上很多好的近似算法都是在Greedy算法基础上做改进，让贪心也许能少贪点得出的好算法。

